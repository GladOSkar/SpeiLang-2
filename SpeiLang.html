<html lang="de-DE">
	<head>
		<script src="pouchdb-3.6.0.min.js"></script>
		<style>
			body {font-family: arial, sans-serif; font-size: 20; font-weight: bold;}
			.forms {
				margin:auto;
				width:300px;
				background:orange;
				padding:20px;
				padding-top: 0px;
				text-align: center;
				margin-top:40px;
			}
			h1{padding-top: 20px; margin-bottom: -10px}
			input, button, select {width: 300px; margin-top: 2; margin-bottom: 8; font-size: 30}
			button {height: 50px;}
			.half {width: 147px;}
		</style>
	</head>
	<body>
		<div style="display:inline-block;">
			<div class="forms">
				<h1>Nabe</h1>
				<br> &nbsp;&nbsp;Marke - Modell
				<br> <select class="half">
						<option value="CAMPAGNOLO">Campagnolo</option>
						<option value="DARINGONALAWUTZ">Dolski Zajazd</option>
						<option value="WOLZA">Wolski Zajazd</option>
					 </select>
					 <select class="half"></select>
				<br> Lochkreisdurchmesser WD
				<br> &nbsp;&nbsp;&nbsp;Links - Rechts
				<br> <input id="val2" type="text" value="44" class="half">
					 <input id="val3" type="text" value="44" class="half">
				<br> Gesamtbreite EBM
				<br> <input id="val4" type="text" value="130">
				<br> Abstand WL / WR
				<br> &nbsp;&nbsp;&nbsp;Links - Rechts
				<br> <input id="val5" type="text" value="44" class="half">
					 <input id="val6" type="text" value="44" class="half">
				<br> Anzahl Speichenlöcher Nabe
				<br> <input id="val7" type="text" value="36">
				<br> Speichenlochdurchmesser
				<br> <input id="val8" type="text" value="2.6">
			</div>
			<div class="forms">
				<br> Anzahl Speichenkreuzungen
				<br> <input id="val9" type="text" value="3">
			</div>
		</div>
		<div style="display:inline-block;">
			<div class="forms">
				<h1>Felge</h1>
				<br> &nbsp;&nbsp;Marke - Modell
				<br> <select class="half"></select>
					 <select class="half"></select>
				<br> Felgendurchmesser
				<br> <input id="val1" type="text" value="618">
				<br> Anzahl Speichenlöcher Felge
				<br> <input id="val10" type="text" value="36">
			</div>
			<div class="forms">
				<br> <br> <button id="SLbutton">Ausrechnen!</button>
				<br> Länge:
				<br> &nbsp;&nbsp;&nbsp;Links - Rechts
				<br> <input id="outl" type="text" class="half">
					 <input id="outr" type="text" class="half">
			</div>
		</div>
	</body>
	<script>
		function getLaengen(RFelge, RLochkreisL, RLochkreisR, NabenBreite, AL, AR, LochZahl, RSpeichenLoch, KreuzungsZahl) {
			var coswinkel =  Math.cos((360 / LochZahl * KreuzungsZahl) / 57.3);
			var BL = NabenBreite - AL;
			var BR = NabenBreite - AR;

			var LL = Math.sqrt(
				RFelge * RFelge  +
				RLochkreisL * RLochkreisL +
				BL * BL -
				2 * RFelge * RLochkreisL * coswinkel
			);

			var LR = Math.sqrt(
				RFelge * RFelge  +
				RLochkreisR * RLochkreisR +
				BR * BR -
				2 * RFelge * RLochkreisR * coswinkel
			);

			LL = (LL - RSpeichenLoch).toFixed(2);
			LR = (LR - RSpeichenLoch).toFixed(2);
			return {links : LL, rechts : LR};
		};

		function calc() {
			var vals = [];

			for (i = 1; i < 11; i++) {
				vals[i] = document.getElementById("val" + i).value;
			}

			if (vals[7] == vals[10]) {
				var ergebnisse = getLaengen(
					vals[1] * 0.5,		//	1.) FelgenDurchmesser					D1
					vals[2] * 0.5,		//	2.) NabeLochkreisDurchmesserWDL			D2L
					vals[3] * 0.5,		//	3.) NabeLochkreisDurchmesserWDR			D2R
					vals[4] * 0.5,		//	4.) AbstandGabelZuGabelEBM				???(130)
					vals[5],			//	5.) AbstandRahmenZuSpeichenLoecherWL	AL
					vals[6],			//	6.) AbstandRahmenZuSpeichenLoecherWR	AR
					vals[7] * 0.5,		//	7.) AnzahlSpeichenLoecher				Lochzahl
					vals[8] * 0.5,		//	8.) SpeichenLochDurchmesserNabe			DSL
					vals[9]				//	9.) AnzahlSpeichenKreuzungen			???(3)
				);
				console.log("Links: " + ergebnisse.links+ "; Rechts: " + ergebnisse.rechts);
				document.getElementById("outl").value = ergebnisse.links;
				document.getElementById("outr").value = ergebnisse.rechts;
			} else {
				console.log("Ungleiche Speichenanzahl! (Felge: " + vals[10] + " Löcher & Nabe: " + vals[7] + " Löcher!)");
				alert("Ungleiche Speichenanzahl! (Felge: " + vals[10] + " Löcher & Nabe: " + vals[7] + " Löcher!)");
				document.getElementById("outl").value = "-";
				document.getElementById("outr").value = "-";
				return;
			};
		};

		document.getElementById("SLbutton").addEventListener("click", calc);

		var felgenDB = new PouchDB('felgen');
		var remoteCouch = false;

		db.changes({
			since: 'now',
			live: true
		}).on('change', updateTeile);

		function addFelge(pmarke,pmodell,pDM,pAnzahlSpeichen) {
			var teil = {
				_id: new Date().toISOString(),
				marke: pmarke,
				modell: pmodell,
				durchmesser: pDM,
				anzahlspeichen: pAnzahlSpeichen
			};
			felgenDB.put(teil, function callback(err, result) {
				if (!err) {
					console.log('Erfolgreich eingetragen!');
				}
			});
		}

		function updateTeile() {
			db.allDocs({include_docs: true, descending: true}, function(err, doc) {
				redrawTodosUI(doc.rows);
			});
		}

	</script>
</html>
